# Trafilatura-Browser 本地引用指南

## 方案1：npm link（推荐用于开发）

### 步骤一：创建链接

```bash
# 在 trafilatura-browser 目录
cd /Users/mxc/coding/trafilatura-js/trafilatura-browser

# 安装依赖（如果还没安装）
npm install

# 创建全局链接
npm link
```

### 步骤二：在你的项目中使用

```bash
# 进入你的项目目录
cd /path/to/your-project

# 链接 trafilatura-browser
npm link trafilatura-browser
```

### 步骤三：在代码中使用

```javascript
// your-project/index.js
import { extract, bareExtraction, extractMetadata } from 'trafilatura-browser';

// 基础提取
const html = `
  <html>
    <body>
      <article>
        <h1>文章标题</h1>
        <p>这是文章内容...</p>
      </article>
    </body>
  </html>
`;

const text = extract(html);
console.log(text);

// 带配置的提取
const result = extract(html, {
  outputFormat: 'markdown',
  withMetadata: true,
  formatting: true,
  links: false,
  images: false
});
console.log(result);

// 完整文档提取
const doc = bareExtraction(html, {
  withMetadata: true
});
console.log('标题:', doc.title);
console.log('作者:', doc.author);
console.log('日期:', doc.date);
console.log('内容:', doc.text);
```

---

## 方案2：先构建再引用（推荐用于生产）

### 步骤一：构建项目

```bash
cd /Users/mxc/coding/trafilatura-js/trafilatura-browser

# 安装依赖
npm install

# 构建所有格式
npm run build

# 构建完成后，会生成：
# dist/trafilatura.cjs.js      - CommonJS 格式
# dist/trafilatura.esm.js      - ES Module 格式
# dist/trafilatura.browser.js  - UMD 浏览器格式
# dist/trafilatura.browser.min.js - UMD 压缩版
```

### 步骤二：在 Node.js 项目中使用

```javascript
// 方式A：ES Module
import { extract } from '../trafilatura-js/trafilatura-browser/dist/trafilatura.esm.js';

// 方式B：CommonJS
const { extract } = require('../trafilatura-js/trafilatura-browser/dist/trafilatura.cjs.js');

// 使用
const text = extract(html);
```

### 步骤三：在浏览器中使用

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Trafilatura 测试</title>
</head>
<body>
  <h1>内容提取测试</h1>
  <textarea id="input" rows="10" cols="80" placeholder="输入 HTML..."></textarea>
  <button onclick="extractContent()">提取内容</button>
  <pre id="output"></pre>

  <!-- 引用构建后的文件 -->
  <script src="../trafilatura-js/trafilatura-browser/dist/trafilatura.browser.js"></script>
  
  <script>
    function extractContent() {
      const html = document.getElementById('input').value;
      
      // 使用全局 Trafilatura 对象
      const result = Trafilatura.extract(html, {
        outputFormat: 'markdown',
        withMetadata: true
      });
      
      document.getElementById('output').textContent = result;
    }
    
    // 测试：提取当前页面内容
    const pageContent = Trafilatura.extract(document.documentElement.outerHTML);
    console.log('当前页面内容:', pageContent);
  </script>
</body>
</html>
```

---

## 方案3：使用 file: 协议

### 在你的项目 package.json 中添加：

```json
{
  "name": "your-project",
  "version": "1.0.0",
  "dependencies": {
    "trafilatura-browser": "file:../trafilatura-js/trafilatura-browser"
  }
}
```

### 然后安装并使用：

```bash
npm install
```

```javascript
// 像使用普通 npm 包一样
import { extract } from 'trafilatura-browser';

const text = extract(html);
```

---

## 方案4：直接引用源码（不推荐）

```javascript
// 直接从 src 引用（仅开发调试）
import { extract } from '/Users/mxc/coding/trafilatura-js/trafilatura-browser/src/index.js';
```

⚠️ **警告**：需要你的构建工具支持处理源码中的导入

---

## API 使用示例

### 1. 基础文本提取

```javascript
import { extract } from 'trafilatura-browser';

const html = '<html>...</html>';
const text = extract(html);
// 默认返回 Markdown 格式
```

### 2. 配置选项

```javascript
const options = {
  outputFormat: 'txt',        // 'txt' | 'markdown' | 'json'
  withMetadata: true,          // 是否包含元数据
  formatting: true,            // 是否保留格式（粗体、斜体）
  links: false,                // 是否包含链接
  images: false,               // 是否包含图片
  tables: true,                // 是否包含表格
  focus: 'balanced',           // 'precision' | 'balanced' | 'recall'
  minExtractedSize: 200       // 最小文本长度
};

const result = extract(html, options);
```

### 3. 获取完整文档对象

```javascript
import { bareExtraction } from 'trafilatura-browser';

const doc = bareExtraction(html, {
  withMetadata: true
});

console.log({
  title: doc.title,
  author: doc.author,
  date: doc.date,
  description: doc.description,
  categories: doc.categories,
  tags: doc.tags,
  text: doc.text,
  comments: doc.comments
});
```

### 4. 仅提取元数据

```javascript
import { extractMetadata } from 'trafilatura-browser';

const url = 'https://example.com/article';
const metadata = extractMetadata(html, url);

console.log({
  title: metadata.title,
  author: metadata.author,
  date: metadata.date,
  url: metadata.url,
  hostname: metadata.hostname
});
```

### 5. 不同输出格式

```javascript
// Markdown 格式（默认）
const markdown = extract(html, { outputFormat: 'markdown' });

// 纯文本格式
const plainText = extract(html, { outputFormat: 'txt' });

// JSON 格式
const json = extract(html, { outputFormat: 'json' });
const data = JSON.parse(json);
```

---

## 解除链接

如果使用了 npm link，想要解除：

```bash
# 在你的项目中
npm unlink trafilatura-browser

# 在 trafilatura-browser 目录
npm unlink
```

---

## 常见问题

### Q1: 构建失败怎么办？

```bash
# 清理后重新安装
cd /Users/mxc/coding/trafilatura-js/trafilatura-browser
rm -rf node_modules package-lock.json
npm install
npm run build
```

### Q2: npm link 后找不到模块？

检查 package.json 的 main、module 字段是否正确指向构建文件，如果使用源码模式，确保引用的是 src/index.js

### Q3: 在浏览器中报错？

确保使用的是 UMD 版本：
- `dist/trafilatura.browser.js` 
- `dist/trafilatura.browser.min.js`

### Q4: TypeScript 支持？

项目包含类型定义：`types/index.d.ts`（如果存在）

---

## 总结

| 方案 | 适用场景 | 需要构建 |
|------|---------|---------|
| npm link | 开发调试，多项目 | ❌ |
| 构建后引用 | 生产环境 | ✅ |
| file: 协议 | 长期依赖 | ❌ |
| 直接源码 | 特殊需求 | ❌ |

**推荐**：开发阶段用 **npm link**，生产环境先 **构建** 再引用。

