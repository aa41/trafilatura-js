<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trafilatura.js - æ ¼å¼åŒ–å™¨å®Œæ•´æµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
      line-height: 1.6;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .controls {
      padding: 20px 30px;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
    }

    .btn-info {
      background: #3b82f6;
      color: white;
    }

    .format-selector {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .format-btn {
      padding: 8px 16px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .format-btn.active {
      background: #667eea;
      color: white;
    }

    .format-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
    }

    .content {
      padding: 30px;
    }

    .test-section {
      margin-bottom: 40px;
    }

    .test-section h2 {
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #667eea;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .test-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      background: #fafafa;
      transition: all 0.3s;
    }

    .test-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .test-card h3 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 1.2em;
    }

    .test-card p {
      color: #666;
      margin-bottom: 15px;
      font-size: 0.9em;
    }

    .test-card button {
      width: 100%;
    }

    .result-panel {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      max-height: 600px;
      overflow: auto;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #444;
    }

    .result-title {
      color: #10b981;
      font-weight: 600;
      font-size: 1.1em;
    }

    .result-meta {
      display: flex;
      gap: 15px;
      font-size: 0.9em;
    }

    .result-meta span {
      color: #888;
    }

    .result-meta .success {
      color: #10b981;
    }

    .result-meta .warning {
      color: #f59e0b;
    }

    .result-content {
      color: #d4d4d4;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 13px;
      line-height: 1.8;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-value {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 25px;
      background: #10b981;
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      animation: slideIn 0.3s ease-out;
      z-index: 1000;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .comparison-view {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .comparison-item {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
    }

    .comparison-header {
      background: #667eea;
      color: white;
      padding: 15px;
      font-weight: 600;
    }

    .comparison-content {
      padding: 15px;
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: monospace;
      font-size: 12px;
      max-height: 400px;
      overflow: auto;
    }

    pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸš€ Trafilatura.js å®Œæ•´æµ‹è¯•å¥—ä»¶</h1>
      <p>æµè§ˆå™¨ç¯å¢ƒä¸‹çš„çœŸå®é›†æˆæµ‹è¯• - æ‰€æœ‰æ ¼å¼åŒ–å™¨</p>
    </header>

    <div class="controls">
      <button class="btn btn-primary" onclick="runAllTests()">
        <span id="run-all-text">è¿è¡Œæ‰€æœ‰æµ‹è¯•</span>
      </button>
      <button class="btn btn-success" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
      <button class="btn btn-warning" onclick="runPerformanceTest()">æ€§èƒ½æµ‹è¯•</button>
      <button class="btn btn-info" onclick="compareFormats()">æ ¼å¼å¯¹æ¯”</button>
      
      <div class="format-selector" style="margin-left: auto;">
        <button class="format-btn active" data-format="markdown" onclick="selectFormat('markdown')">Markdown</button>
        <button class="format-btn" data-format="xml" onclick="selectFormat('xml')">XML-TEI</button>
        <button class="format-btn" data-format="json" onclick="selectFormat('json')">JSON</button>
        <button class="format-btn" data-format="html" onclick="selectFormat('html')">HTML</button>
        <button class="format-btn" data-format="csv" onclick="selectFormat('csv')">CSV</button>
        <button class="format-btn" data-format="txt" onclick="selectFormat('txt')">TXT</button>
      </div>
    </div>

    <div class="content">
      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="total-tests">0</div>
          <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="passed-tests">0</div>
          <div class="stat-label">é€šè¿‡</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="failed-tests">0</div>
          <div class="stat-label">å¤±è´¥</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avg-time">0ms</div>
          <div class="stat-label">å¹³å‡è€—æ—¶</div>
        </div>
      </div>

      <!-- æµ‹è¯•ç”¨ä¾‹ -->
      <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•åœºæ™¯</h2>
        <div class="test-grid">
          <div class="test-card">
            <h3>ç®€å•åšå®¢æ–‡ç« </h3>
            <p>åŒ…å«æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€ä»£ç ã€å¼•ç”¨ç­‰åŸºç¡€å…ƒç´ </p>
            <button class="btn btn-primary" onclick="testBlogPost()">è¿è¡Œæµ‹è¯•</button>
          </div>

          <div class="test-card">
            <h3>å¸¦è¡¨æ ¼çš„æ–°é—»</h3>
            <p>æµ‹è¯•è¡¨æ ¼æå–å’Œæ ¼å¼åŒ–èƒ½åŠ›</p>
            <button class="btn btn-primary" onclick="testNewsWithTable()">è¿è¡Œæµ‹è¯•</button>
          </div>

          <div class="test-card">
            <h3>å­¦æœ¯æ–‡ç« </h3>
            <p>å¤æ‚ç»“æ„ï¼Œé€‚åˆXML-TEIæ ¼å¼</p>
            <button class="btn btn-primary" onclick="testAcademicArticle()">è¿è¡Œæµ‹è¯•</button>
          </div>

          <div class="test-card">
            <h3>å¸¦å›¾ç‰‡æ–‡ç« </h3>
            <p>æµ‹è¯•å›¾ç‰‡æå–å’Œaltæ–‡æœ¬å¤„ç†</p>
            <button class="btn btn-primary" onclick="testArticleWithImages()">è¿è¡Œæµ‹è¯•</button>
          </div>

          <div class="test-card">
            <h3>å¤æ‚æ ¼å¼æ–‡ç« </h3>
            <p>åµŒå¥—åˆ—è¡¨ã€å¤šç§æ ¼å¼åŒ–æ ‡è®°</p>
            <button class="btn btn-primary" onclick="testComplexFormat()">è¿è¡Œæµ‹è¯•</button>
          </div>

          <div class="test-card">
            <h3>å½“å‰é¡µé¢</h3>
            <p>æå–æœ¬é¡µé¢å†…å®¹è¿›è¡Œæµ‹è¯•</p>
            <button class="btn btn-primary" onclick="testCurrentPage()">è¿è¡Œæµ‹è¯•</button>
          </div>
        </div>
      </div>

      <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
      <div id="results-container"></div>
    </div>
  </div>

  <!-- å¼•å…¥æ„å»ºåçš„åº“ -->
  <script src="../dist/trafilatura.umd.js"></script>
  
  <script>
    // å…¨å±€å˜é‡
    let selectedFormat = 'markdown';
    let testResults = [];
    let totalTests = 0;
    let passedTests = 0;
    let failedTests = 0;

    // æ ¼å¼é€‰æ‹©
    function selectFormat(format) {
      selectedFormat = format;
      document.querySelectorAll('.format-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.format === format);
      });
      showToast(`å·²åˆ‡æ¢åˆ° ${format.toUpperCase()} æ ¼å¼`);
    }

    // æ˜¾ç¤ºæç¤º
    function showToast(message, duration = 2000) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, duration);
    }

    // æ›´æ–°ç»Ÿè®¡
    function updateStats() {
      document.getElementById('total-tests').textContent = totalTests;
      document.getElementById('passed-tests').textContent = passedTests;
      document.getElementById('failed-tests').textContent = failedTests;
      
      if (testResults.length > 0) {
        const avgTime = testResults.reduce((sum, r) => sum + r.duration, 0) / testResults.length;
        document.getElementById('avg-time').textContent = Math.round(avgTime) + 'ms';
      }
    }

    // æ˜¾ç¤ºç»“æœ
    function displayResult(title, content, duration, success = true) {
      const container = document.getElementById('results-container');
      
      const resultPanel = document.createElement('div');
      resultPanel.className = 'result-panel';
      
      resultPanel.innerHTML = `
        <div class="result-header">
          <div class="result-title">${success ? 'âœ…' : 'âŒ'} ${title}</div>
          <div class="result-meta">
            <span>æ ¼å¼: <span class="${success ? 'success' : 'warning'}">${selectedFormat.toUpperCase()}</span></span>
            <span>è€—æ—¶: <span class="success">${duration}ms</span></span>
            <span>é•¿åº¦: <span class="success">${content.length} å­—ç¬¦</span></span>
          </div>
        </div>
        <div class="result-content">${escapeHtml(content.substring(0, 3000))}${content.length > 3000 ? '\n\n... (å†…å®¹è¿‡é•¿ï¼Œä»…æ˜¾ç¤ºå‰3000å­—ç¬¦)' : ''}</div>
      `;
      
      container.insertBefore(resultPanel, container.firstChild);
      
      // è®°å½•ç»“æœ
      testResults.push({ title, format: selectedFormat, duration, success, length: content.length });
      totalTests++;
      if (success) passedTests++;
      else failedTests++;
      
      updateStats();
    }

    // HTMLè½¬ä¹‰
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // æµ‹è¯•è¾…åŠ©å‡½æ•°
    async function runTest(name, html) {
      try {
        const startTime = performance.now();
        
        const result = await Trafilatura.extract(html, {
          output_format: selectedFormat,
          with_metadata: true,
          include_formatting: true,
          include_links: true,
          include_images: true,
        });
        
        const endTime = performance.now();
        const duration = Math.round(endTime - startTime);
        
        if (result) {
          displayResult(name, result, duration, true);
          return { success: true, duration };
        } else {
          displayResult(name, 'æå–å¤±è´¥ï¼šè¿”å›null', duration, false);
          return { success: false, duration };
        }
      } catch (error) {
        displayResult(name, `é”™è¯¯: ${error.message}\n${error.stack}`, 0, false);
        return { success: false, duration: 0 };
      }
    }

    // æµ‹è¯•ç”¨ä¾‹1ï¼šç®€å•åšå®¢
    async function testBlogPost() {
      const html = `
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>JavaScriptå­¦ä¹ æŒ‡å—</title>
  <meta name="author" content="æŠ€æœ¯åšä¸»">
  <meta name="description" content="å…¨é¢çš„JavaScriptå­¦ä¹ è·¯å¾„">
</head>
<body>
  <article>
    <h1>JavaScriptå­¦ä¹ æŒ‡å—</h1>
    <p>JavaScriptæ˜¯ç°ä»£Webå¼€å‘çš„æ ¸å¿ƒæŠ€æœ¯ã€‚æœ¬æ–‡å°†ä»‹ç»ç³»ç»Ÿçš„å­¦ä¹ æ–¹æ³•ã€‚</p>
    
    <h2>åŸºç¡€æ¦‚å¿µ</h2>
    <p>é¦–å…ˆéœ€è¦ç†è§£ä»¥ä¸‹æ ¸å¿ƒæ¦‚å¿µï¼š</p>
    <ul>
      <li>å˜é‡å’Œæ•°æ®ç±»å‹</li>
      <li>å‡½æ•°å’Œé—­åŒ…</li>
      <li>åŸå‹å’Œç»§æ‰¿</li>
      <li>å¼‚æ­¥ç¼–ç¨‹</li>
    </ul>
    
    <h2>å­¦ä¹ è·¯å¾„</h2>
    <ol>
      <li>æŒæ¡JavaScriptåŸºç¡€è¯­æ³•</li>
      <li>ç†è§£DOMå’ŒBOM</li>
      <li>å­¦ä¹ ES6+æ–°ç‰¹æ€§</li>
      <li>æŒæ¡ç°ä»£æ¡†æ¶</li>
    </ol>
    
    <blockquote>
      <p>å®è·µæ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹æ³•ã€‚</p>
    </blockquote>
    
    <pre><code>
// Hello World
console.log('Hello, JavaScript!');
    </code></pre>
  </article>
</body>
</html>
      `;
      
      await runTest('ç®€å•åšå®¢æ–‡ç« ', html);
    }

    // æµ‹è¯•ç”¨ä¾‹2ï¼šå¸¦è¡¨æ ¼çš„æ–°é—»
    async function testNewsWithTable() {
      const html = `
<!DOCTYPE html>
<html>
<head>
  <title>2023ç§‘æŠ€æŠ¥å‘Š</title>
  <meta name="author" content="ç§‘æŠ€è®°è€…">
</head>
<body>
  <article>
    <h1>2023å¹´ç§‘æŠ€å‘å±•æŠ¥å‘Š</h1>
    <p>æœ¬æŠ¥å‘Šå…¨é¢åˆ†æäº†ä¸»è¦ç§‘æŠ€é¢†åŸŸåœ¨2023å¹´çš„å‘å±•è¶‹åŠ¿å’Œå¸‚åœºè¡¨ç°ã€‚é€šè¿‡å¯¹äººå·¥æ™ºèƒ½ã€äº‘è®¡ç®—ã€ç‰©è”ç½‘ã€åŒºå—é“¾ç­‰å…³é”®æŠ€æœ¯é¢†åŸŸçš„æ·±å…¥ç ”ç©¶ï¼Œæˆ‘ä»¬å‘ç°ç§‘æŠ€åˆ›æ–°æ­£åœ¨ä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦æ¨åŠ¨ç¤¾ä¼šè¿›æ­¥å’Œç»æµå‘å±•ã€‚</p>
    
    <h2>ä¸»è¦æŠ€æœ¯é¢†åŸŸ</h2>
    <p>ä»¥ä¸‹è¡¨æ ¼å±•ç¤ºäº†å„æŠ€æœ¯é¢†åŸŸçš„å…³é”®æŒ‡æ ‡æ•°æ®ï¼š</p>
    <table>
      <thead>
        <tr>
          <th>é¢†åŸŸ</th>
          <th>å¹´å¢é•¿ç‡</th>
          <th>å¸‚åœºè§„æ¨¡</th>
          <th>ä»ä¸šäººæ•°</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>äººå·¥æ™ºèƒ½</td>
          <td>45%</td>
          <td>$500B</td>
          <td>280ä¸‡</td>
        </tr>
        <tr>
          <td>äº‘è®¡ç®—</td>
          <td>32%</td>
          <td>$800B</td>
          <td>450ä¸‡</td>
        </tr>
        <tr>
          <td>ç‰©è”ç½‘</td>
          <td>28%</td>
          <td>$350B</td>
          <td>320ä¸‡</td>
        </tr>
      </tbody>
    </table>
    
    <p>ä»æ•°æ®å¯ä»¥çœ‹å‡ºï¼Œäººå·¥æ™ºèƒ½é¢†åŸŸçš„å¢é•¿æœ€ä¸ºè¿…é€Ÿï¼Œå¹´å¢é•¿ç‡è¾¾åˆ°45%ï¼Œè¿™ä¸»è¦å¾—ç›Šäºæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„çªç ´å’Œå¤§æ¨¡å‹çš„å¹¿æ³›åº”ç”¨ã€‚äº‘è®¡ç®—è™½ç„¶å¢é€Ÿç›¸å¯¹è¾ƒæ…¢ï¼Œä½†å¸‚åœºè§„æ¨¡æœ€å¤§ï¼Œå·²ç»æˆä¸ºä¼ä¸šæ•°å­—åŒ–è½¬å‹çš„åŸºç¡€è®¾æ–½ã€‚</p>
    
    <h2>æœªæ¥å±•æœ›</h2>
    <p>é¢„è®¡åœ¨æœªæ¥ä¸‰å¹´å†…ï¼Œè¿™äº›æŠ€æœ¯é¢†åŸŸå°†ç»§ç»­ä¿æŒå¼ºåŠ²çš„å¢é•¿åŠ¿å¤´ï¼Œå¹¶ä¸”ç›¸äº’èåˆï¼Œåˆ›é€ å‡ºæ›´å¤šåˆ›æ–°çš„åº”ç”¨åœºæ™¯ã€‚</p>
  </article>
</body>
</html>
      `;
      
      await runTest('å¸¦è¡¨æ ¼çš„æ–°é—»æ–‡ç« ', html);
    }

    // æµ‹è¯•ç”¨ä¾‹3ï¼šå­¦æœ¯æ–‡ç« 
    async function testAcademicArticle() {
      const html = `
<!DOCTYPE html>
<html>
<head>
  <title>æ·±åº¦å­¦ä¹ ç ”ç©¶ç»¼è¿°</title>
  <meta name="author" content="ç ”ç©¶å‘˜">
  <meta name="keywords" content="æ·±åº¦å­¦ä¹ ,ç¥ç»ç½‘ç»œ,AI">
</head>
<body>
  <article>
    <h1>æ·±åº¦å­¦ä¹ åœ¨NLPä¸­çš„åº”ç”¨</h1>
    
    <h2>æ‘˜è¦</h2>
    <p>æœ¬æ–‡ç»¼è¿°äº†æ·±åº¦å­¦ä¹ æŠ€æœ¯åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸçš„æœ€æ–°è¿›å±•ã€‚</p>
    
    <h2>1. å¼•è¨€</h2>
    <p>è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰æ˜¯äººå·¥æ™ºèƒ½çš„é‡è¦åˆ†æ”¯ã€‚</p>
    
    <h2>2. ç›¸å…³å·¥ä½œ</h2>
    <p>Transformeræ¶æ„çš„æå‡ºæå¤§åœ°æ¨åŠ¨äº†NLPçš„å‘å±•ã€‚</p>
    
    <blockquote cite="Vaswani et al., 2017">
      <p>Attentionæœºåˆ¶æ˜¯Transformerçš„æ ¸å¿ƒã€‚</p>
    </blockquote>
    
    <h2>3. ç»“è®º</h2>
    <p>æ·±åº¦å­¦ä¹ æ–¹æ³•å–å¾—äº†æ˜¾è‘—æˆæœã€‚</p>
    
    <h2>å‚è€ƒæ–‡çŒ®</h2>
    <ol>
      <li>Vaswani et al. (2017). Attention is All You Need.</li>
      <li>Devlin et al. (2018). BERT.</li>
    </ol>
  </article>
</body>
</html>
      `;
      
      await runTest('å­¦æœ¯æ–‡ç« ', html);
    }

    // æµ‹è¯•ç”¨ä¾‹4ï¼šå¸¦å›¾ç‰‡
    async function testArticleWithImages() {
      const html = `
<!DOCTYPE html>
<html>
<head>
  <title>è‡ªç„¶é£å…‰æ‘„å½±</title>
  <meta name="description" content="ä¸“ä¸šæ‘„å½±å¸ˆåˆ†äº«è‡ªç„¶é£å…‰æ‹æ‘„ç»éªŒ">
</head>
<body>
  <article>
    <h1>è‡ªç„¶é£å…‰æ‘„å½±æŠ€å·§å®Œå…¨æŒ‡å—</h1>
    <p>è‡ªç„¶é£å…‰æ‘„å½±æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œä¹Ÿæ˜¯ä¸€é—¨æŠ€æœ¯ã€‚å®ƒéœ€è¦æ‘„å½±å¸ˆä¸ä»…è¦æœ‰æ•é”çš„è§‚å¯ŸåŠ›å’Œå®¡ç¾çœ¼å…‰ï¼Œè¿˜è¦æŒæ¡ç›¸æœºçš„å„ç§æŠ€æœ¯å‚æ•°å’Œæ‹æ‘„æŠ€å·§ã€‚æœ¬æ–‡å°†ç³»ç»Ÿåœ°ä»‹ç»å¦‚ä½•æ•æ‰å¤§è‡ªç„¶çš„ç¾ä¸½ç¬é—´ï¼Œå¸®åŠ©æ‘„å½±çˆ±å¥½è€…æå‡ä½œå“è´¨é‡ã€‚</p>
    
    <h2>å…‰çº¿çš„è¿ç”¨</h2>
    <p>å…‰çº¿æ˜¯æ‘„å½±çš„çµé­‚ã€‚åœ¨è‡ªç„¶é£å…‰æ‘„å½±ä¸­ï¼Œé»„é‡‘æ—¶æ®µï¼ˆæ—¥å‡ºåå’Œæ—¥è½å‰çš„ä¸€å°æ—¶ï¼‰æä¾›äº†æœ€æŸ”å’Œã€æœ€æ¸©æš–çš„å…‰çº¿ã€‚è¿™ä¸ªæ—¶å€™çš„å…‰çº¿è§’åº¦è¾ƒä½ï¼Œèƒ½å¤Ÿè¥é€ å‡ºå±‚æ¬¡ä¸°å¯Œçš„ç”»é¢æ•ˆæœã€‚</p>
    
    <figure>
      <img src="https://example.com/mountain.jpg" alt="å£®ä¸½çš„å±±å³°">
      <figcaption>å–œé©¬æ‹‰é›…å±±è„‰åœ¨æ—¥å‡ºæ—¶åˆ†çš„å£®ä¸½æ™¯è±¡</figcaption>
    </figure>
    
    <p>å¦‚å›¾æ‰€ç¤ºï¼Œå±±å³°åœ¨æ—¥å‡ºæ—¶åˆ†æœ€ä¸ºå£®è§‚ã€‚ä¾§å…‰èƒ½å¤Ÿå‡¸æ˜¾å±±ä½“çš„çº¹ç†å’Œç«‹ä½“æ„Ÿï¼Œé‡‘è‰²çš„é˜³å…‰ç»™ç”»é¢å¢æ·»äº†æ¸©æš–çš„è‰²è°ƒã€‚æ‹æ‘„è¿™æ ·çš„åœºæ™¯éœ€è¦æå‰åˆ°è¾¾æ‹æ‘„åœ°ç‚¹ï¼Œåšå¥½å……åˆ†çš„å‡†å¤‡å·¥ä½œã€‚</p>
    
    <h2>æ„å›¾åŸåˆ™</h2>
    <p>å¥½çš„æ„å›¾æ˜¯æˆåŠŸä½œå“çš„åŸºç¡€ã€‚ä¸‰åˆ†æ³•æ˜¯æœ€å¸¸ç”¨çš„æ„å›¾æ–¹æ³•ï¼Œå°†ç”»é¢åˆ†æˆä¹å®«æ ¼ï¼ŒæŠŠä¸»ä½“æ”¾åœ¨äº¤å‰ç‚¹ä¸Šã€‚æ­¤å¤–ï¼Œå¼•å¯¼çº¿ã€å¯¹ç§°ã€æ¡†æ¶ç­‰æ„å›¾æŠ€å·§ä¹Ÿèƒ½è®©ç…§ç‰‡æ›´å…·è§†è§‰å†²å‡»åŠ›ã€‚</p>
    
    <h2>æ‹æ‘„æŠ€å·§</h2>
    <p>ä»¥ä¸‹æ˜¯ä¸€äº›å®ç”¨çš„æ‹æ‘„æŠ€å·§å»ºè®®ï¼š</p>
    <ul>
      <li>é€‰æ‹©åˆé€‚çš„å…‰çº¿ï¼šä¼˜å…ˆé€‰æ‹©é»„é‡‘æ—¶æ®µæ‹æ‘„ï¼Œé¿å…æ­£åˆçš„å¼ºå…‰</li>
      <li>å¯»æ‰¾æœ‰è¶£çš„æ„å›¾ï¼šè¿ç”¨ä¸‰åˆ†æ³•ã€å¼•å¯¼çº¿ç­‰æ„å›¾åŸåˆ™</li>
      <li>ä½¿ç”¨ä¸‰è„šæ¶ï¼šä¿è¯ç”»é¢ç¨³å®šï¼Œç‰¹åˆ«æ˜¯åœ¨é•¿æ›å…‰æ—¶å¿…ä¸å¯å°‘</li>
      <li>è°ƒæ•´æ›å…‰å‚æ•°ï¼šæ ¹æ®ç°åœºå…‰çº¿çµæ´»è°ƒæ•´ISOã€å…‰åœˆå’Œå¿«é—¨é€Ÿåº¦</li>
      <li>ä½¿ç”¨æ»¤é•œï¼šåæŒ¯é•œå¯ä»¥å‡å°‘åå…‰ï¼Œæ¸å˜ç°æ»¤é•œå¹³è¡¡å¤©åœ°å…‰æ¯”</li>
    </ul>
    
    <h2>åæœŸå¤„ç†</h2>
    <p>é€‚å½“çš„åæœŸå¤„ç†å¯ä»¥è®©ç…§ç‰‡é”¦ä¸Šæ·»èŠ±ã€‚ä½†è¦æ³¨æ„ä¿æŒç”»é¢çš„è‡ªç„¶æ„Ÿï¼Œä¸è¦è¿‡åº¦è°ƒæ•´å¯¼è‡´å¤±çœŸã€‚ä¸»è¦çš„åæœŸå·¥ä½œåŒ…æ‹¬è°ƒæ•´æ›å…‰ã€å¢å¼ºå¯¹æ¯”åº¦ã€ä¼˜åŒ–è‰²å½©å¹³è¡¡ç­‰ã€‚</p>
  </article>
</body>
</html>
      `;
      
      await runTest('å¸¦å›¾ç‰‡çš„æ–‡ç« ', html);
    }

    // æµ‹è¯•ç”¨ä¾‹5ï¼šå¤æ‚æ ¼å¼
    async function testComplexFormat() {
      const html = `
<!DOCTYPE html>
<html>
<head>
  <title>Markdownè¯­æ³•æŒ‡å—</title>
</head>
<body>
  <article>
    <h1>Markdownå®Œå…¨æŒ‡å—</h1>
    
    <h2>æ–‡æœ¬æ ¼å¼</h2>
    <p>æ”¯æŒ<strong>ç²—ä½“</strong>ã€<em>æ–œä½“</em>å’Œ<del>åˆ é™¤çº¿</del>ã€‚</p>
    
    <h3>åˆ—è¡¨</h3>
    <ul>
      <li>é¡¹ç›®ä¸€</li>
      <li>é¡¹ç›®äºŒ
        <ul>
          <li>å­é¡¹ç›®2.1</li>
          <li>å­é¡¹ç›®2.2</li>
        </ul>
      </li>
      <li>é¡¹ç›®ä¸‰</li>
    </ul>
    
    <h3>ä»£ç </h3>
    <p>å†…è”ä»£ç ï¼š<code>console.log()</code></p>
    
    <pre><code class="language-python">
def hello():
    print("Hello, World!")
    </code></pre>
    
    <h2>é“¾æ¥</h2>
    <p>è®¿é—®<a href="https://example.com">ç¤ºä¾‹ç½‘ç«™</a>ã€‚</p>
    
    <hr>
    
    <p>ä»¥ä¸Šæ˜¯Markdownçš„åŸºæœ¬è¯­æ³•ã€‚</p>
  </article>
</body>
</html>
      `;
      
      await runTest('å¤æ‚æ ¼å¼æ–‡ç« ', html);
    }

    // æµ‹è¯•ç”¨ä¾‹6ï¼šå½“å‰é¡µé¢
    async function testCurrentPage() {
      const html = document.documentElement.outerHTML;
      await runTest('å½“å‰é¡µé¢å†…å®¹', html);
    }

    // è¿è¡Œæ‰€æœ‰æµ‹è¯•
    async function runAllTests() {
      const runBtn = document.getElementById('run-all-text');
      runBtn.innerHTML = '<span class="loading"></span> è¿è¡Œä¸­...';
      
      clearResults();
      
      const tests = [
        testBlogPost,
        testNewsWithTable,
        testAcademicArticle,
        testArticleWithImages,
        testComplexFormat,
      ];
      
      for (const test of tests) {
        await test();
        await new Promise(resolve => setTimeout(resolve, 100)); // çŸ­æš‚å»¶è¿Ÿ
      }
      
      runBtn.textContent = 'è¿è¡Œæ‰€æœ‰æµ‹è¯•';
      showToast(`âœ… å®Œæˆï¼å…±${totalTests}ä¸ªæµ‹è¯•ï¼Œé€šè¿‡${passedTests}ä¸ª`);
    }

    // æ¸…é™¤ç»“æœ
    function clearResults() {
      document.getElementById('results-container').innerHTML = '';
      testResults = [];
      totalTests = 0;
      passedTests = 0;
      failedTests = 0;
      updateStats();
    }

    // æ€§èƒ½æµ‹è¯•
    async function runPerformanceTest() {
      showToast('å¼€å§‹æ€§èƒ½æµ‹è¯•...', 1000);
      
      const testHtml = `
<!DOCTYPE html>
<html><head><title>æµ‹è¯•</title></head>
<body><article><h1>æ ‡é¢˜</h1><p>${'æµ‹è¯•å†…å®¹'.repeat(100)}</p></article></body>
</html>
      `;
      
      const formats = ['txt', 'markdown', 'xml', 'json', 'html', 'csv'];
      const iterations = 10;
      const results = {};
      
      for (const format of formats) {
        const times = [];
        for (let i = 0; i < iterations; i++) {
          const start = performance.now();
          await Trafilatura.extract(testHtml, { output_format: format });
          const end = performance.now();
          times.push(end - start);
        }
        results[format] = {
          avg: times.reduce((a, b) => a + b, 0) / times.length,
          min: Math.min(...times),
          max: Math.max(...times),
        };
      }
      
      let report = 'æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼ˆæ¯ä¸ªæ ¼å¼è¿è¡Œ' + iterations + 'æ¬¡ï¼‰\n\n';
      report += 'æ ¼å¼      å¹³å‡è€—æ—¶    æœ€å°      æœ€å¤§\n';
      report += 'â”'.repeat(50) + '\n';
      
      for (const [format, stats] of Object.entries(results)) {
        report += `${format.padEnd(10)}${Math.round(stats.avg)}ms${(' '.repeat(8))}${Math.round(stats.min)}ms${(' '.repeat(6))}${Math.round(stats.max)}ms\n`;
      }
      
      displayResult('æ€§èƒ½æµ‹è¯•', report, 0, true);
    }

    // æ ¼å¼å¯¹æ¯”
    async function compareFormats() {
      showToast('å¼€å§‹æ ¼å¼å¯¹æ¯”...', 1000);
      
      const testHtml = `
<!DOCTYPE html>
<html>
<head><title>æµ‹è¯•æ–‡ç« </title></head>
<body>
  <article>
    <h1>ä¸»æ ‡é¢˜</h1>
    <p>è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬ã€‚</p>
    <ul>
      <li>åˆ—è¡¨é¡¹1</li>
      <li>åˆ—è¡¨é¡¹2</li>
    </ul>
    <blockquote><p>å¼•ç”¨å†…å®¹</p></blockquote>
  </article>
</body>
</html>
      `;
      
      const container = document.getElementById('results-container');
      const comparisonDiv = document.createElement('div');
      comparisonDiv.className = 'result-panel';
      
      let html = '<div class="result-header"><div class="result-title">ğŸ“Š æ ¼å¼å¯¹æ¯”</div></div>';
      html += '<div class="comparison-view">';
      
      const formats = ['markdown', 'xml', 'json', 'html', 'csv', 'txt'];
      
      for (const format of formats) {
        const result = await Trafilatura.extract(testHtml, { 
          output_format: format,
          with_metadata: true 
        });
        
        html += `
          <div class="comparison-item">
            <div class="comparison-header">${format.toUpperCase()}</div>
            <div class="comparison-content">
              <pre>${escapeHtml(result ? result.substring(0, 500) : 'æ— è¾“å‡º')}</pre>
            </div>
          </div>
        `;
      }
      
      html += '</div>';
      comparisonDiv.innerHTML = html;
      container.insertBefore(comparisonDiv, container.firstChild);
    }

    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    window.addEventListener('load', () => {
      console.log('Trafilatura.js æµ‹è¯•å¥—ä»¶å·²åŠ è½½');
      console.log('å¯ç”¨çš„API:', Trafilatura);
      showToast('æµ‹è¯•å¥—ä»¶å·²å°±ç»ªï¼', 2000);
    });
  </script>
</body>
</html>

