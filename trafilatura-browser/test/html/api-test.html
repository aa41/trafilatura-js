<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trafilatura APIå®Œæ•´æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    h2 {
      color: #667eea;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }
    .success { color: #28a745; }
    .error { color: #dc3545; }
    .info { color: #17a2b8; }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      max-height: 300px;
    }
    .api-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }
    .api-item {
      padding: 10px;
      background: #f8f9fa;
      border-radius: 4px;
      border-left: 4px solid #28a745;
    }
    .api-item.missing {
      border-left-color: #dc3545;
    }
  </style>
</head>
<body>
  <h1>ğŸš€ Trafilatura Browser - APIå®Œæ•´æµ‹è¯•</h1>
  
  <div class="test-section">
    <h2>1. åº“åŠ è½½çŠ¶æ€</h2>
    <div id="library-status"></div>
  </div>
  
  <div class="test-section">
    <h2>2. APIå¯¼å‡ºéªŒè¯</h2>
    <div id="api-exports"></div>
  </div>
  
  <div class="test-section">
    <h2>3. æ ¸å¿ƒAPIæµ‹è¯•</h2>
    <div id="core-api-test"></div>
  </div>
  
  <div class="test-section">
    <h2>4. extract()å‡½æ•°è¯¦ç»†æµ‹è¯•</h2>
    <div id="extract-test"></div>
  </div>
  
  <div class="test-section">
    <h2>5. å®Œæ•´æµ‹è¯•æ€»ç»“</h2>
    <div id="summary"></div>
  </div>

  <script src="../../dist/trafilatura.browser.js"></script>
  <script>
    const results = {
      passed: 0,
      failed: 0,
      tests: []
    };

    function log(msg, type = 'info') {
      const colors = { success: '#28a745', error: '#dc3545', info: '#17a2b8' };
      console.log(`%c${msg}`, `color: ${colors[type]}`);
    }

    function addTest(name, passed, details) {
      results.tests.push({ name, passed, details });
      if (passed) results.passed++;
      else results.failed++;
    }

    // 1. æ£€æŸ¥åº“åŠ è½½
    const libraryStatusDiv = document.getElementById('library-status');
    if (typeof Trafilatura !== 'undefined') {
      libraryStatusDiv.innerHTML = `
        <p class="success">âœ… Trafilaturaå¯¹è±¡å·²åŠ è½½</p>
        <p><strong>å¯¹è±¡ç±»å‹:</strong> ${typeof Trafilatura}</p>
        <p><strong>æ„é€ å‡½æ•°:</strong> ${Trafilatura.constructor.name}</p>
      `;
      addTest('åº“åŠ è½½', true, 'Trafilaturaå¯¹è±¡å­˜åœ¨');
    } else {
      libraryStatusDiv.innerHTML = '<p class="error">âŒ Trafilaturaå¯¹è±¡æœªåŠ è½½ï¼</p>';
      addTest('åº“åŠ è½½', false, 'Trafilaturaå¯¹è±¡ä¸å­˜åœ¨');
    }

    // 2. APIå¯¼å‡ºéªŒè¯
    const apiExportsDiv = document.getElementById('api-exports');
    const expectedAPIs = {
      'æ ¸å¿ƒAPI': ['extract', 'bareExtraction'],
      'é…ç½®ç±»': ['Extractor', 'Document', 'createExtractor', 'createDocument'],
      'åŸºç¡€æå–': ['baseline', 'html2txt', 'basicCleaning'],
      'å·¥å…·å‡½æ•°': ['loadHtml', 'trim', 'sanitize'],
      'å¤„ç†å‡½æ•°': ['treeCleaning', 'pruneHtml', 'linkDensityTest'],
      'å¸¸é‡': ['MANUALLY_CLEANED', 'MANUALLY_STRIPPED', 'CUT_EMPTY_ELEMS']
    };

    let apiHTML = '';
    let allAPIsPresent = true;

    for (const [category, apis] of Object.entries(expectedAPIs)) {
      apiHTML += `<h3>${category}</h3><div class="api-list">`;
      for (const api of apis) {
        const exists = typeof Trafilatura[api] !== 'undefined';
        const typeStr = typeof Trafilatura[api];
        const className = exists ? 'api-item' : 'api-item missing';
        const icon = exists ? 'âœ…' : 'âŒ';
        apiHTML += `<div class="${className}">${icon} ${api}<br><small>(${typeStr})</small></div>`;
        if (!exists) allAPIsPresent = false;
        addTest(`API: ${api}`, exists, `ç±»å‹: ${typeStr}`);
      }
      apiHTML += '</div>';
    }

    apiExportsDiv.innerHTML = apiHTML;

    // 3. æ ¸å¿ƒAPIæµ‹è¯•
    const coreApiTestDiv = document.getElementById('core-api-test');
    let coreTestHTML = '';

    // æµ‹è¯• extract å‡½æ•°æ˜¯å¦å¯è°ƒç”¨
    if (typeof Trafilatura.extract === 'function') {
      coreTestHTML += '<p class="success">âœ… Trafilatura.extract æ˜¯ä¸€ä¸ªå‡½æ•°</p>';
      addTest('extractç±»å‹æ£€æŸ¥', true, 'extractæ˜¯å‡½æ•°');
    } else {
      coreTestHTML += '<p class="error">âŒ Trafilatura.extract ä¸æ˜¯å‡½æ•°</p>';
      addTest('extractç±»å‹æ£€æŸ¥', false, `extractæ˜¯${typeof Trafilatura.extract}`);
    }

    // æµ‹è¯•å…¶ä»–æ ¸å¿ƒAPI
    ['bareExtraction', 'baseline', 'loadHtml'].forEach(api => {
      if (typeof Trafilatura[api] === 'function') {
        coreTestHTML += `<p class="success">âœ… Trafilatura.${api} å¯ç”¨</p>`;
        addTest(`${api}å¯ç”¨æ€§`, true, 'å‡½æ•°å­˜åœ¨');
      } else {
        coreTestHTML += `<p class="error">âŒ Trafilatura.${api} ä¸å¯ç”¨</p>`;
        addTest(`${api}å¯ç”¨æ€§`, false, 'å‡½æ•°ä¸å­˜åœ¨');
      }
    });

    coreApiTestDiv.innerHTML = coreTestHTML;

    // 4. extract()å‡½æ•°è¯¦ç»†æµ‹è¯•
    const extractTestDiv = document.getElementById('extract-test');
    let extractTestHTML = '';

    try {
      const testHTML = `
        <html>
          <head>
            <title>æµ‹è¯•é¡µé¢</title>
          </head>
          <body>
            <nav>å¯¼èˆªæ </nav>
            <article>
              <h1>æ–‡ç« æ ‡é¢˜</h1>
              <p>è¿™æ˜¯ç¬¬ä¸€æ®µå†…å®¹ï¼ŒåŒ…å«å®é™…çš„æ–‡ç« å†…å®¹ã€‚</p>
              <p>è¿™æ˜¯ç¬¬äºŒæ®µå†…å®¹ï¼Œä¹Ÿæ˜¯æ–‡ç« çš„ä¸€éƒ¨åˆ†ã€‚</p>
            </article>
            <footer>é¡µè„š</footer>
          </body>
        </html>
      `;

      log('å¼€å§‹extractæµ‹è¯•...', 'info');
      const result = Trafilatura.extract(testHTML);
      
      extractTestHTML += '<h3>æµ‹è¯•è¾“å…¥</h3>';
      extractTestHTML += `<pre>${testHTML.trim()}</pre>`;
      
      extractTestHTML += '<h3>æå–ç»“æœ</h3>';
      extractTestHTML += `<p><strong>ç»“æœç±»å‹:</strong> ${typeof result}</p>`;
      extractTestHTML += `<p><strong>ç»“æœé•¿åº¦:</strong> ${result ? result.length : 0} å­—ç¬¦</p>`;
      
      if (result) {
        extractTestHTML += '<h4>æå–çš„å†…å®¹:</h4>';
        extractTestHTML += `<pre>${result}</pre>`;
        
        // éªŒè¯æå–çš„å†…å®¹
        const checks = {
          'åŒ…å«æ ‡é¢˜': result.includes('æ–‡ç« æ ‡é¢˜') || result.includes('æ ‡é¢˜'),
          'åŒ…å«å†…å®¹': result.includes('ç¬¬ä¸€æ®µå†…å®¹') || result.includes('ç¬¬äºŒæ®µå†…å®¹'),
          'ä¸åŒ…å«å¯¼èˆª': !result.includes('å¯¼èˆªæ '),
          'ä¸åŒ…å«é¡µè„š': !result.includes('é¡µè„š')
        };
        
        extractTestHTML += '<h4>å†…å®¹éªŒè¯:</h4><ul>';
        for (const [check, passed] of Object.entries(checks)) {
          extractTestHTML += `<li class="${passed ? 'success' : 'error'}">${passed ? 'âœ…' : 'âŒ'} ${check}</li>`;
          addTest(`extract: ${check}`, passed, 'å†…å®¹æ£€æŸ¥');
        }
        extractTestHTML += '</ul>';
        
        addTest('extractå‡½æ•°æ‰§è¡Œ', true, `è¿”å›${result.length}å­—ç¬¦`);
      } else {
        extractTestHTML += '<p class="error">âŒ extractè¿”å›äº†ç©ºç»“æœ</p>';
        addTest('extractå‡½æ•°æ‰§è¡Œ', false, 'è¿”å›ç©ºç»“æœ');
      }
      
    } catch (error) {
      extractTestHTML += `<p class="error">âŒ extractæµ‹è¯•å¤±è´¥</p>`;
      extractTestHTML += `<pre class="error">${error.message}\n\n${error.stack}</pre>`;
      addTest('extractå‡½æ•°æ‰§è¡Œ', false, error.message);
      log('Extractæµ‹è¯•å¤±è´¥: ' + error.message, 'error');
    }

    extractTestDiv.innerHTML = extractTestHTML;

    // 5. æ€»ç»“
    const summaryDiv = document.getElementById('summary');
    const total = results.passed + results.failed;
    const passRate = total > 0 ? ((results.passed / total) * 100).toFixed(1) : 0;
    
    summaryDiv.innerHTML = `
      <h3>${results.failed === 0 ? 'âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼' : 'âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥'}</h3>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
        <div style="text-align: center; padding: 20px; background: #d4edda; border-radius: 8px;">
          <div style="font-size: 36px; font-weight: bold; color: #28a745;">${results.passed}</div>
          <div>é€šè¿‡</div>
        </div>
        <div style="text-align: center; padding: 20px; background: ${results.failed > 0 ? '#f8d7da' : '#e2e3e5'}; border-radius: 8px;">
          <div style="font-size: 36px; font-weight: bold; color: ${results.failed > 0 ? '#dc3545' : '#6c757d'};">${results.failed}</div>
          <div>å¤±è´¥</div>
        </div>
        <div style="text-align: center; padding: 20px; background: #d1ecf1; border-radius: 8px;">
          <div style="font-size: 36px; font-weight: bold; color: #17a2b8;">${passRate}%</div>
          <div>é€šè¿‡ç‡</div>
        </div>
      </div>
      <details>
        <summary style="cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 4px;">
          <strong>æŸ¥çœ‹æ‰€æœ‰æµ‹è¯•è¯¦æƒ…ï¼ˆ${total}ä¸ªæµ‹è¯•ï¼‰</strong>
        </summary>
        <ul style="margin-top: 10px;">
          ${results.tests.map(t => 
            `<li class="${t.passed ? 'success' : 'error'}">
              ${t.passed ? 'âœ…' : 'âŒ'} ${t.name} - ${t.details}
            </li>`
          ).join('')}
        </ul>
      </details>
    `;

    // æ§åˆ¶å°è¾“å‡º
    log('='.repeat(50), 'info');
    log(`æµ‹è¯•å®Œæˆ: ${results.passed}/${total} é€šè¿‡ (${passRate}%)`, results.failed === 0 ? 'success' : 'error');
    log('='.repeat(50), 'info');
  </script>
</body>
</html>

