<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trafilatura Browser - æµ‹è¯•å¥—ä»¶</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .subtitle {
      opacity: 0.9;
      font-size: 1.1em;
    }

    .controls {
      padding: 20px;
      background: #f9f9f9;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: #667eea;
      color: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    button.secondary {
      background: #6c757d;
    }

    button.secondary:hover {
      background: #5a6268;
    }

    .stats {
      margin-left: auto;
      display: flex;
      gap: 20px;
    }

    .stat {
      text-align: center;
    }

    .stat-label {
      font-size: 12px;
      color: #666;
      display: block;
    }

    .stat-value {
      font-size: 20px;
      font-weight: bold;
      display: block;
    }

    .stat-value.success { color: #28a745; }
    .stat-value.error { color: #dc3545; }
    .stat-value.pending { color: #ffc107; }

    .test-results {
      padding: 20px;
    }

    .test-case {
      margin-bottom: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
      transition: all 0.3s;
    }

    .test-case:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .test-header {
      padding: 15px 20px;
      background: #f8f9fa;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .test-header:hover {
      background: #e9ecef;
    }

    .test-title {
      font-weight: 600;
      font-size: 1.1em;
    }

    .test-status {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status-icon {
      font-size: 24px;
    }

    .test-time {
      font-size: 12px;
      color: #666;
    }

    .test-body {
      padding: 20px;
      display: none;
      border-top: 1px solid #e0e0e0;
    }

    .test-body.expanded {
      display: block;
    }

    .test-case.success {
      border-left: 4px solid #28a745;
    }

    .test-case.error {
      border-left: 4px solid #dc3545;
    }

    .test-case.running {
      border-left: 4px solid #ffc107;
    }

    .result-section {
      margin-bottom: 15px;
    }

    .result-label {
      font-weight: 600;
      margin-bottom: 5px;
      color: #666;
    }

    .result-content {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 400px;
      overflow-y: auto;
    }

    .error-message {
      color: #dc3545;
      background: #f8d7da;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state svg {
      width: 64px;
      height: 64px;
      opacity: 0.3;
      margin-bottom: 20px;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .progress-bar {
      height: 4px;
      background: #e0e0e0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      width: 0%;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸš€ Trafilatura Browser</h1>
      <div class="subtitle">æµè§ˆå™¨ç«¯å†…å®¹æå–æµ‹è¯•å¥—ä»¶</div>
    </header>

    <div class="progress-bar">
      <div class="progress-fill" id="progress"></div>
    </div>

    <div class="controls">
      <button onclick="runAllTests()" id="runAllBtn">
        è¿è¡Œæ‰€æœ‰æµ‹è¯•
      </button>
      <button class="secondary" onclick="runCategory('basic')">åŸºç¡€æå–</button>
      <button class="secondary" onclick="runCategory('metadata')">å…ƒæ•°æ®</button>
      <button class="secondary" onclick="runCategory('formatting')">æ ¼å¼åŒ–</button>
      <button class="secondary" onclick="runCategory('advanced')">é«˜çº§åŠŸèƒ½</button>
      <button class="secondary" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>

      <div class="stats">
        <div class="stat">
          <span class="stat-label">é€šè¿‡</span>
          <span class="stat-value success" id="passedCount">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">å¤±è´¥</span>
          <span class="stat-value error" id="failedCount">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">æ€»è®¡</span>
          <span class="stat-value" id="totalCount">0</span>
        </div>
      </div>
    </div>

    <div class="test-results" id="testResults">
      <div class="empty-state">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p>ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹æµ‹è¯•</p>
      </div>
    </div>
  </div>

  <script>
    // æµ‹è¯•ç”¨ä¾‹å®šä¹‰
    const testCases = {
      // ===== åŸºç¡€æå–æµ‹è¯• =====
      basicExtraction: {
        category: 'basic',
        name: 'åŸºç¡€æ–‡æœ¬æå–',
        description: 'æµ‹è¯•ä»ç®€å•HTMLä¸­æå–çº¯æ–‡æœ¬',
        html: `
          <html>
          <head><title>æµ‹è¯•é¡µé¢</title></head>
          <body>
            <header>é¡µå¤´å¯¼èˆª</header>
            <nav>å¯¼èˆªèœå•</nav>
            <article>
              <h1>æ–‡ç« æ ‡é¢˜</h1>
              <p>è¿™æ˜¯ç¬¬ä¸€æ®µå†…å®¹ï¼ŒåŒ…å«ä¸€äº›æ–‡å­—ã€‚</p>
              <p>è¿™æ˜¯ç¬¬äºŒæ®µå†…å®¹ï¼Œä¹ŸåŒ…å«æ–‡å­—ã€‚</p>
            </article>
            <aside>ä¾§è¾¹æ å¹¿å‘Š</aside>
            <footer>é¡µè„šç‰ˆæƒ</footer>
          </body>
          </html>
        `,
        expected: {
          contains: ['æ–‡ç« æ ‡é¢˜', 'ç¬¬ä¸€æ®µå†…å®¹', 'ç¬¬äºŒæ®µå†…å®¹'],
          notContains: ['é¡µå¤´å¯¼èˆª', 'å¯¼èˆªèœå•', 'ä¾§è¾¹æ å¹¿å‘Š', 'é¡µè„šç‰ˆæƒ']
        }
      },

      // ===== å…ƒæ•°æ®æå–æµ‹è¯• =====
      metadataBasic: {
        category: 'metadata',
        name: 'åŸºç¡€å…ƒæ•°æ®æå–',
        description: 'æµ‹è¯•ä»metaæ ‡ç­¾æå–å…ƒæ•°æ®',
        html: `
          <html>
          <head>
            <meta name="author" content="å¼ ä¸‰">
            <meta name="description" content="è¿™æ˜¯ä¸€ç¯‡æµ‹è¯•æ–‡ç« çš„æè¿°">
            <title>æµ‹è¯•æ–‡ç« æ ‡é¢˜ - ç½‘ç«™åç§°</title>
          </head>
          <body>
            <article><p>æ–‡ç« å†…å®¹</p></article>
          </body>
          </html>
        `,
        options: { withMetadata: true, outputFormat: 'json' },
        expected: {
          metadata: {
            author: 'å¼ ä¸‰',
            description: 'è¿™æ˜¯ä¸€ç¯‡æµ‹è¯•æ–‡ç« çš„æè¿°'
          }
        }
      },

      metadataOpenGraph: {
        category: 'metadata',
        name: 'OpenGraphå…ƒæ•°æ®æå–',
        description: 'æµ‹è¯•ä»OpenGraphæ ‡ç­¾æå–å…ƒæ•°æ®',
        html: `
          <html>
          <head>
            <meta property="og:title" content="OGæ ‡é¢˜">
            <meta property="og:description" content="OGæè¿°">
            <meta property="og:author" content="æå››">
            <meta property="og:site_name" content="æµ‹è¯•ç½‘ç«™">
          </head>
          <body>
            <article><p>å†…å®¹</p></article>
          </body>
          </html>
        `,
        options: { withMetadata: true, outputFormat: 'json' },
        expected: {
          metadata: {
            title: 'OGæ ‡é¢˜',
            description: 'OGæè¿°',
            author: 'æå››',
            sitename: 'æµ‹è¯•ç½‘ç«™'
          }
        }
      },

      // ===== æ ¼å¼åŒ–æµ‹è¯• =====
      formattingMarkdown: {
        category: 'formatting',
        name: 'Markdownæ ¼å¼åŒ–',
        description: 'æµ‹è¯•Markdownæ ¼å¼è¾“å‡º',
        html: `
          <html>
          <body>
            <article>
              <h1>ä¸€çº§æ ‡é¢˜</h1>
              <h2>äºŒçº§æ ‡é¢˜</h2>
              <p>åŒ…å«<strong>ç²—ä½“</strong>å’Œ<em>æ–œä½“</em>çš„æ®µè½</p>
              <p>è¿™é‡Œæœ‰ä¸€ä¸ª<a href="https://example.com">é“¾æ¥</a></p>
              <ul>
                <li>åˆ—è¡¨é¡¹1</li>
                <li>åˆ—è¡¨é¡¹2</li>
              </ul>
            </article>
          </body>
          </html>
        `,
        options: { outputFormat: 'markdown', formatting: true, links: true },
        expected: {
          contains: [
            '# ä¸€çº§æ ‡é¢˜',
            '## äºŒçº§æ ‡é¢˜',
            '**ç²—ä½“**',
            '*æ–œä½“*',
            '[é“¾æ¥](https://example.com)',
            '- åˆ—è¡¨é¡¹1',
            '- åˆ—è¡¨é¡¹2'
          ]
        }
      },

      formattingTable: {
        category: 'formatting',
        name: 'è¡¨æ ¼æ ¼å¼åŒ–',
        description: 'æµ‹è¯•è¡¨æ ¼çš„Markdownè¾“å‡º',
        html: `
          <html>
          <body>
            <article>
              <table>
                <thead>
                  <tr>
                    <th>åˆ—1</th>
                    <th>åˆ—2</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>æ•°æ®1</td>
                    <td>æ•°æ®2</td>
                  </tr>
                  <tr>
                    <td>æ•°æ®3</td>
                    <td>æ•°æ®4</td>
                  </tr>
                </tbody>
              </table>
            </article>
          </body>
          </html>
        `,
        options: { outputFormat: 'markdown', tables: true },
        expected: {
          contains: ['åˆ—1', 'åˆ—2', 'æ•°æ®1', 'æ•°æ®2', '---']
        }
      },

      // ===== é«˜çº§åŠŸèƒ½æµ‹è¯• =====
      advancedLinkDensity: {
        category: 'advanced',
        name: 'é“¾æ¥å¯†åº¦è¿‡æ»¤',
        description: 'æµ‹è¯•é“¾æ¥å¯†åº¦ç®—æ³•è¿‡æ»¤å¯¼èˆªæ ',
        html: `
          <html>
          <body>
            <nav>
              <a href="#">é“¾æ¥1</a>
              <a href="#">é“¾æ¥2</a>
              <a href="#">é“¾æ¥3</a>
              å°‘é‡æ–‡æœ¬
            </nav>
            <article>
              <p>è¿™æ˜¯ä¸€ä¸ªåŒ…å«å¤§é‡æ–‡æœ¬çš„æ­£å¸¸æ®µè½ã€‚
              <a href="#">è¿™é‡Œæœ‰ä¸€ä¸ªé“¾æ¥</a>
              ä½†é“¾æ¥åªå å¾ˆå°ä¸€éƒ¨åˆ†ã€‚</p>
            </article>
          </body>
          </html>
        `,
        expected: {
          contains: ['æ­£å¸¸æ®µè½', 'é“¾æ¥åªå å¾ˆå°ä¸€éƒ¨åˆ†'],
          notContains: ['é“¾æ¥1', 'é“¾æ¥2', 'é“¾æ¥3']
        }
      },

      advancedNested: {
        category: 'advanced',
        name: 'åµŒå¥—ç»“æ„å¤„ç†',
        description: 'æµ‹è¯•å¤æ‚åµŒå¥—HTMLç»“æ„',
        html: `
          <html>
          <body>
            <article>
              <div class="content">
                <section>
                  <h2>ç« èŠ‚æ ‡é¢˜</h2>
                  <div class="text">
                    <p>æ®µè½1</p>
                    <div>
                      <p>åµŒå¥—æ®µè½2</p>
                    </div>
                  </div>
                </section>
              </div>
            </article>
          </body>
          </html>
        `,
        expected: {
          contains: ['ç« èŠ‚æ ‡é¢˜', 'æ®µè½1', 'åµŒå¥—æ®µè½2']
        }
      }
    };

    // æµ‹è¯•çŠ¶æ€
    let stats = {
      passed: 0,
      failed: 0,
      total: 0
    };

    // è¿è¡Œå•ä¸ªæµ‹è¯•
    async function runTest(testId, testCase) {
      const startTime = performance.now();
      
      try {
        // æ£€æŸ¥Trafilaturaæ˜¯å¦å·²åŠ è½½
        if (typeof Trafilatura === 'undefined') {
          throw new Error('Trafilaturaåº“æœªåŠ è½½ï¼è¯·å…ˆæ„å»ºé¡¹ç›®ï¼šnpm run build');
        }

        // è¿è¡Œæå–
        const options = testCase.options || {};
        const result = Trafilatura.extract(testCase.html, options);
        
        // éªŒè¯ç»“æœ
        const errors = [];
        
        if (testCase.expected.contains) {
          for (const text of testCase.expected.contains) {
            if (!result.includes(text)) {
              errors.push(`ç¼ºå°‘æœŸæœ›æ–‡æœ¬: "${text}"`);
            }
          }
        }
        
        if (testCase.expected.notContains) {
          for (const text of testCase.expected.notContains) {
            if (result.includes(text)) {
              errors.push(`ä¸åº”åŒ…å«æ–‡æœ¬: "${text}"`);
            }
          }
        }
        
        if (testCase.expected.metadata && typeof result === 'string') {
          const parsed = JSON.parse(result);
          for (const [key, value] of Object.entries(testCase.expected.metadata)) {
            if (parsed[key] !== value) {
              errors.push(`å…ƒæ•°æ®ä¸åŒ¹é…: ${key} æœŸæœ›"${value}", å®é™…"${parsed[key] || 'undefined'}"`);
            }
          }
        }
        
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(2);
        
        if (errors.length === 0) {
          stats.passed++;
          return { success: true, result, duration };
        } else {
          stats.failed++;
          return { success: false, result, errors, duration };
        }
        
      } catch (error) {
        stats.failed++;
        const endTime = performance.now();
        const duration = (endTime - startTime).toFixed(2);
        return { 
          success: false, 
          error: error.message, 
          stack: error.stack,
          duration 
        };
      }
    }

    // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
    function displayTestResult(testId, testCase, testResult) {
      const resultsDiv = document.getElementById('testResults');
      
      // ç§»é™¤ç©ºçŠ¶æ€
      const emptyState = resultsDiv.querySelector('.empty-state');
      if (emptyState) emptyState.remove();
      
      const testDiv = document.createElement('div');
      testDiv.className = `test-case ${testResult.success ? 'success' : 'error'}`;
      testDiv.id = `test-${testId}`;
      
      const statusIcon = testResult.success ? 'âœ…' : 'âŒ';
      
      testDiv.innerHTML = `
        <div class="test-header" onclick="toggleTestBody('${testId}')">
          <div class="test-title">
            <span class="status-icon">${statusIcon}</span>
            ${testCase.name}
          </div>
          <div class="test-status">
            <span class="test-time">${testResult.duration}ms</span>
          </div>
        </div>
        <div class="test-body" id="body-${testId}">
          <div class="result-section">
            <div class="result-label">ğŸ“ æè¿°</div>
            <p>${testCase.description}</p>
          </div>
          
          ${testResult.error ? `
            <div class="error-message">
              <strong>é”™è¯¯:</strong> ${testResult.error}
              ${testResult.stack ? `<pre style="margin-top: 10px; font-size: 11px;">${testResult.stack}</pre>` : ''}
            </div>
          ` : ''}
          
          ${testResult.errors ? `
            <div class="error-message">
              <strong>éªŒè¯å¤±è´¥:</strong>
              <ul style="margin-top: 5px; padding-left: 20px;">
                ${testResult.errors.map(e => `<li>${e}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
          
          <div class="result-section">
            <div class="result-label">ğŸ“¤ æå–ç»“æœ</div>
            <div class="result-content">${escapeHtml(testResult.result || '')}</div>
          </div>
          
          <div class="result-section">
            <div class="result-label">ğŸ“¥ è¾“å…¥HTML</div>
            <div class="result-content">${escapeHtml(testCase.html)}</div>
          </div>
        </div>
      `;
      
      resultsDiv.appendChild(testDiv);
    }

    // åˆ‡æ¢æµ‹è¯•è¯¦æƒ…å±•å¼€/æ”¶èµ·
    function toggleTestBody(testId) {
      const body = document.getElementById(`body-${testId}`);
      body.classList.toggle('expanded');
    }

    // æ›´æ–°ç»Ÿè®¡
    function updateStats() {
      document.getElementById('passedCount').textContent = stats.passed;
      document.getElementById('failedCount').textContent = stats.failed;
      document.getElementById('totalCount').textContent = stats.total;
      
      const progress = stats.total > 0 ? (stats.passed + stats.failed) / stats.total * 100 : 0;
      document.getElementById('progress').style.width = `${progress}%`;
    }

    // è¿è¡Œæ‰€æœ‰æµ‹è¯•
    async function runAllTests() {
      clearResults();
      stats = { passed: 0, failed: 0, total: Object.keys(testCases).length };
      updateStats();
      
      const runAllBtn = document.getElementById('runAllBtn');
      runAllBtn.disabled = true;
      runAllBtn.innerHTML = '<span class="loading"></span> è¿è¡Œä¸­...';
      
      for (const [testId, testCase] of Object.entries(testCases)) {
        const result = await runTest(testId, testCase);
        displayTestResult(testId, testCase, result);
        updateStats();
        await sleep(100); // çŸ­æš‚å»¶è¿Ÿï¼Œè®©UIæ›´æ–°
      }
      
      runAllBtn.disabled = false;
      runAllBtn.textContent = 'è¿è¡Œæ‰€æœ‰æµ‹è¯•';
    }

    // è¿è¡ŒæŒ‡å®šç±»åˆ«çš„æµ‹è¯•
    async function runCategory(category) {
      clearResults();
      
      const filtered = Object.entries(testCases)
        .filter(([_, test]) => test.category === category);
      
      stats = { passed: 0, failed: 0, total: filtered.length };
      updateStats();
      
      for (const [testId, testCase] of filtered) {
        const result = await runTest(testId, testCase);
        displayTestResult(testId, testCase, result);
        updateStats();
        await sleep(100);
      }
    }

    // æ¸…ç©ºç»“æœ
    function clearResults() {
      const resultsDiv = document.getElementById('testResults');
      resultsDiv.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <p>ç­‰å¾…æµ‹è¯•è¿è¡Œ...</p>
        </div>
      `;
      stats = { passed: 0, failed: 0, total: 0 };
      updateStats();
    }

    // å·¥å…·å‡½æ•°
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥åº“æ˜¯å¦å·²åŠ è½½
    window.addEventListener('load', () => {
      if (typeof Trafilatura === 'undefined') {
        const resultsDiv = document.getElementById('testResults');
        resultsDiv.innerHTML = `
          <div class="error-message" style="margin: 20px;">
            <h3>âš ï¸ Trafilaturaåº“æœªåŠ è½½</h3>
            <p>è¯·å…ˆæ„å»ºé¡¹ç›®:</p>
            <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0;">npm run build</pre>
            <p>ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ­¤æ–‡ä»¶å‰ï¼Œåœ¨HTMLä¸­æ·»åŠ :</p>
            <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0;">&lt;script src="../../dist/trafilatura.browser.js"&gt;&lt;/script&gt;</pre>
          </div>
        `;
      }
    });
  </script>
  
  
    <!-- æ³¨æ„: åœ¨å®é™…ä½¿ç”¨å‰ï¼Œéœ€è¦å…ˆæ„å»ºé¡¹ç›®å¹¶å–æ¶ˆä¸‹é¢è¿™è¡Œçš„æ³¨é‡Š -->
    <script src="../../dist/trafilatura.browser.js"></script>
 
</body>
</html>

