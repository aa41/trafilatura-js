<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æå–æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        h1 { color: #333; }
        h2 { color: #666; }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ”§ å›¾ç‰‡æå–ä¿®å¤éªŒè¯</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯• 1: åŸºæœ¬å›¾ç‰‡æå–</h2>
        <div id="test1-result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 2: data-src å±æ€§</h2>
        <div id="test2-result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 3: ç›¸å¯¹URLè½¬æ¢</h2>
        <div id="test3-result"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 4: æ®µè½ä¸­çš„å›¾ç‰‡</h2>
        <div id="test4-result"></div>
    </div>

    <script src="dist/trafilatura.browser.js"></script>
    <script>
        function displayResult(testId, success, message, extracted) {
            const resultDiv = document.getElementById(`test${testId}-result`);
            const statusClass = success ? 'success' : 'error';
            const statusText = success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥';
            
            resultDiv.innerHTML = `
                <p class="${statusClass}">${statusText}</p>
                <p>${message}</p>
                ${extracted ? `<pre>${extracted}</pre>` : ''}
            `;
        }

        // æµ‹è¯• 1: åŸºæœ¬å›¾ç‰‡æå–
        function test1() {
            const html = `
                <article>
                    <h1>æµ‹è¯•æ–‡ç« </h1>
                    <img src="https://example.com/image.jpg" alt="æµ‹è¯•å›¾ç‰‡" title="å›¾ç‰‡æ ‡é¢˜">
                    <p>è¿™æ˜¯ä¸€æ®µæ–‡å­—ã€‚</p>
                </article>
            `;
            
            const result = Trafilatura.extract(html, {
                format: 'markdown',
                include_images: true
            });
            
            const hasImage = result && result.includes('![');
            const hasImageSrc = result && result.includes('https://example.com/image.jpg');
            
            displayResult(1, 
                hasImage && hasImageSrc, 
                hasImage ? 'æˆåŠŸæå–å›¾ç‰‡' : 'æœªèƒ½æå–å›¾ç‰‡',
                result
            );
        }

        // æµ‹è¯• 2: data-src å±æ€§
        function test2() {
            const html = `
                <article>
                    <h1>Lazy Loading å›¾ç‰‡</h1>
                    <img data-src="https://example.com/lazy.png" src="placeholder.gif" alt="æ‡’åŠ è½½å›¾ç‰‡">
                    <p>ä½¿ç”¨æ‡’åŠ è½½æŠ€æœ¯ã€‚</p>
                </article>
            `;
            
            const result = Trafilatura.extract(html, {
                format: 'markdown',
                include_images: true
            });
            
            const hasLazyImage = result && result.includes('lazy.png');
            const notHasPlaceholder = result && !result.includes('placeholder.gif');
            
            displayResult(2,
                hasLazyImage && notHasPlaceholder,
                hasLazyImage ? 'æˆåŠŸæå– data-src å›¾ç‰‡' : 'æœªèƒ½æå– data-src',
                result
            );
        }

        // æµ‹è¯• 3: ç›¸å¯¹URLè½¬æ¢
        function test3() {
            const html = `
                <article>
                    <h1>ç›¸å¯¹è·¯å¾„å›¾ç‰‡</h1>
                    <img src="/images/photo.jpg" alt="ç›¸å¯¹è·¯å¾„">
                    <img src="//cdn.example.com/image.png" alt="åè®®ç›¸å¯¹è·¯å¾„">
                </article>
            `;
            
            const result = Trafilatura.extract(html, {
                format: 'markdown',
                include_images: true,
                url: 'https://example.com/article/123'
            });
            
            const hasAbsoluteUrl = result && result.includes('https://example.com/images/photo.jpg');
            const hasProtocol = result && result.includes('http://cdn.example.com/image.png');
            
            displayResult(3,
                hasAbsoluteUrl || hasProtocol,
                hasAbsoluteUrl ? 'æˆåŠŸè½¬æ¢ç›¸å¯¹URL' : 'ç›¸å¯¹URLè½¬æ¢å¯èƒ½æœ‰é—®é¢˜',
                result
            );
        }

        // æµ‹è¯• 4: æ®µè½ä¸­çš„å›¾ç‰‡
        function test4() {
            const html = `
                <article>
                    <h1>æ®µè½åŒ…å«å›¾ç‰‡</h1>
                    <p>
                        è¿™æ˜¯ä¸€ä¸ªåŒ…å«å›¾ç‰‡çš„æ®µè½ã€‚
                        <img src="https://example.com/inline.jpg" alt="å†…è”å›¾ç‰‡">
                        å›¾ç‰‡åé¢è¿˜æœ‰æ–‡å­—ã€‚
                    </p>
                </article>
            `;
            
            const result = Trafilatura.extract(html, {
                format: 'markdown',
                include_images: true
            });
            
            const hasImage = result && result.includes('![å†…è”å›¾ç‰‡](https://example.com/inline.jpg)');
            
            displayResult(4,
                hasImage,
                hasImage ? 'æˆåŠŸæå–æ®µè½ä¸­çš„å›¾ç‰‡' : 'æ®µè½ä¸­çš„å›¾ç‰‡æå–å¤±è´¥ï¼ˆè¿™æ˜¯ä¹‹å‰çš„BUGï¼ï¼‰',
                result
            );
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('å¼€å§‹æµ‹è¯•å›¾ç‰‡æå–åŠŸèƒ½...');
            test1();
            test2();
            test3();
            test4();
            console.log('æ‰€æœ‰æµ‹è¯•å®Œæˆï¼');
        });
    </script>
</body>
</html>

